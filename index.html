<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Hist441-project by dangerful</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <link rel="stylesheet" href="stylesheets/countries.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <script src="javascripts/svg-pan-zoom.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">
      <section>
        <script type="text/javascript">
          var jewDeaths = [];
          d3.json("jewDeaths.json", function(error, deaths) {
            if (error) return console.error(error);
            jewDeaths = deaths;
          });

          <!--https://bost.ocks.org/mike/map/ -->
          var id = "map";
          var section = d3.select("section"); 
          var width = 960,
          height = 920;

          var svg = section.append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("id", id);
          d3.json("cntry1938.json", function(error, world) {
            if (error) return console.error(error);
            console.log(world);
            var countries = topojson.feature(world, world.objects.cntry1938);
            var projection = d3.geo.mercator();
            var path = d3.geo.path().projection(projection);
            svg.append("path")
              .datum(countries)
              .attr("d", path);

            var tooltip = d3.select('body').append('div')
            .attr('class', 'hidden tooltip');

            svg.selectAll(".countries").data(countries.features).enter().append("path")
              .attr("id", "Jew Deaths")
              .attr("class", function(d) { return "country " + d.properties.NAME;})
              .attr("d", path)
              .on('mousemove', function(d) {
                  var mouse = d3.mouse(svg.node()).map(function(d) {
                      return parseInt(d);
                  });
                  var clientRectangle = svg.node().getBoundingClientRect();
                  var overlay = tooltip.classed('hidden', false)
                      .attr('style', 'left:' + (mouse[0] + 15 + clientRectangle.left) +
                              'px; top:' + (mouse[1] - 35 + clientRectangle.top) + 'px');
                  var found = false;
                  for (var i = 0; i < jewDeaths.length; i++){
                    if (jewDeaths[i].country === d.properties.NAME){
                      if (jewDeaths[i].minLoss === jewDeaths[i].maxLoss || jewDeaths[i].maxLoss == null){
                        overlay.html(d.properties.NAME + "<br/>Jew Deaths: ~" + jewDeaths[i].minLoss + "<br/>% of Population: " + jewDeaths[i].percent);
                      } else {
                        overlay.html(d.properties.NAME + "<br/>Jew Deaths: " + jewDeaths[i].minLoss + " - " + jewDeaths[i].maxLoss + "<br/>% of Population: " + jewDeaths[i].percent);
                      }
                      found = true;
                      break;
                    }                    
                  } 
                  if (found === false) {
                    overlay.html(d.properties.NAME);
                  }  
                      
              })
              .on('mouseout', function() {
                  tooltip.classed('hidden', true);
              });

            //svg.append("path")
            //  .datum(topojson.mesh(world, world.objects.cntry1938, function(a, b) { return a !== b; }))
            //  .attr("d", path)
            //  .attr("class", "land-border");
            //svg.append("path")
            //.datum(topojson.mesh(world, world.objects.cntry1938, function(a, b) { return a === b; }))
            //.attr("d", path)
            //.attr("class", "water-border");
            
            var panZoomMap = svgPanZoom('#' + id, {});
          });

          //https://www.sitepoint.com/javascript-generate-lighter-darker-color/
          function ColorLuminance(hex, lum) {
            // validate hex string
            hex = String(hex).replace(/[^0-9a-f]/gi, '');
            if (hex.length < 6) {
              hex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2];
            }
            lum = lum || 0;

            // convert to decimal and change luminosity
            var rgb = "#", c, i;
            for (i = 0; i < 3; i++) {
              c = parseInt(hex.substr(i*2,2), 16);
              c = Math.round(Math.min(Math.max(0, c + (c * lum)), 255)).toString(16);
              rgb += ("00"+c).substr(c.length);
            }

            return rgb;
          }
        </script>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
